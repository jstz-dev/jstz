function o(e){return typeof e=="string"}function a(e,r){return Array.isArray(r)&&r.reduce((n,t)=>n&&e(t),!0)}function c(e){return typeof e=="number"&&Number.isInteger(e)}function k(e){let r=e;try{return o(r.to)&&c(r.token_id)&&Number.isInteger(r.amount)}catch{return!1}}function w(e){let r=e;try{return o(r.from)&&a(k,r.transfers)}catch{return!1}}function A(e){let r=e;try{return(r.operation==="add_operator"||r.operation==="remove_operator")&&o(r.owner)&&o(r.operator)&&c(r.token_id)}catch{return!1}}function l(e){let r=e;try{return o(r.owner)&&c(r.token_id)}catch{return!1}}function R(e){let r=e;try{return o(r.callback)&&a(l,r.requests)}catch{return!1}}function $(e){let r=e;try{return l(r.request)&&Number.isInteger(r.balance)}catch{return!1}}function g(e){let r=e;try{return c(r.token_id)&&o(r.owner)&&Number.isInteger(r.amount)}catch{return!1}}function f(e){return`token/${e}`}function _(e){Kv.set(f(e),!0)}function O(e){if(!Kv.get(f(e)))throw"FA2_TOKEN_UNDEFINED"}function p(e,r){return`balance/${e}/${r}`}function m(e,r){return Kv.get(p(e,r))||0}function h(e,r,n){if(n<0)throw"FA2_INSUFFICIENT_BALANCE";Kv.set(p(e,r),n)}function d(e,r,n){let t=m(e,r);h(e,r,t+n)}function y(e,r,n,t){d(e,n,-t),d(r,n,t)}function u(e,r,n){return`owner/${e}/${r}/${n}`}function b(e,r,n){Kv.set(u(e,r,n),!0)}function I(e,r,n){Kv.delete(u(e,r,n))}function T(e,r,n){if(!(e===r||Kv.get(u(e,r,n))))throw"FA2_NOT_OPERATOR"}function B(e,r){if(e!==r)throw console.log(`${e} !== ${r}`),"FA2_NOT_OWNER"}function N(e,r,n){O(n.token_id),T(e,r,n.token_id),y(e,n.to,n.token_id,n.amount)}function x(e,r){r.forEach(n=>n.transfers.forEach(t=>N(n.from,e,t)))}function v(e,r){switch(r.operation){case"add_operator":B(r.owner,e),b(r.owner,r.operator,r.token_id);break;case"remove_operator":T(r.owner,e,r.token_id),I(r.owner,r.operator,r.token_id)}}function E(e){let r=m(e.owner,e.token_id);return{request:e,balance:r}}async function S(e){let r=e.requests.map(E),n=new Request(`tezos://${e.callback}`,{method:"POST",body:JSON.stringify(r)}),t=Contract.call(n);return r}function P(e){_(e.token_id),d(e.owner,e.token_id,e.amount)}async function U(e){let r=new URL(e.url),n=r.pathname;try{switch(n){case"/ping":return console.log("Hello from runner contract \u{1F44B}"),new Response("Pong");case"/balance_of":if(e.method==="GET"){let s={requests:JSON.parse(TextEncoder.atob(r.searchParams.get("requests"))),callback:r.searchParams.get("callback")};if(R(s)){let i=await S(s);return Response.json(i)}else return console.error("Invalid parameters",s),Response.error()}else{let s="/balance_of is a GET request";return console.error(s),new Response(s,{status:500})}case"/transfer":if(e.method==="POST"){let s=await e.json();return a(w,s)?(x(e.headers.get("Referer"),s),new Response("Success!")):(console.error("Invalid parameters",JSON.stringify(s)),Response.error())}else{let s="/transfer is a POST request";return console.error(s),new Response(s,{status:500})}case"/mint_new":if(e.method==="POST"){let s=await e.json();return a(g,s)?(s.forEach(P),new Response("Success!")):(console.error("Invalid parameters",JSON.stringify(s)),Response.error())}else{let s="/mint_new is a POST request";return console.error(s),new Response(s,{status:500})}case"/update_operators":if(e.method==="PUT"){let s=await e.json();return a(A,s)?(s.forEach(i=>v(e.headers.get("Referer"),i)),new Response("Success!")):(console.error("Invalid parameters",JSON.stringify(s)),Response.error())}else{let s="/update_operators is a PUT request";return console.error(s),new Response(s,{status:500})}default:let t=`Unrecognised entrypoint ${n}`;return console.error(t),new Response(t,{status:404})}}catch(t){throw console.error(t),t}}var F=U;export{F as default,R as isBalanceOf,l as isBalanceRequest,$ as isBalanceResponse,g as isMintNew,c as isTokenId,k as isTransfer,w as isTransfers,A as isUpdateOperator};
