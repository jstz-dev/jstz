{
  "openapi": "3.1.0",
  "info": {
    "title": "Jstz Node",
    "description": "JavaScript server runtime for Tezos Smart Rollups",
    "contact": {
      "name": "Trilitech",
      "email": "contact@trili.tech"
    },
    "license": {
      "name": "MIT",
      "url": "https://github.com/jstz-dev/jstz/blob/main/LICENSE"
    },
    "version": "0.1.0-alpha.0"
  },
  "paths": {
    "/accounts/{address}/balance": {
      "get": {
        "tags": [
          "Accounts"
        ],
        "summary": "Get balance of an account",
        "operationId": "get_balance",
        "parameters": [
          {
            "name": "address",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "integer",
                  "format": "int64",
                  "minimum": 0
                }
              }
            }
          },
          "404": {
            "description": ""
          },
          "500": {
            "description": ""
          }
        }
      }
    },
    "/accounts/{address}/code": {
      "get": {
        "tags": [
          "Accounts"
        ],
        "summary": "Get code of an account",
        "operationId": "get_code",
        "parameters": [
          {
            "name": "address",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ParsedCode"
                }
              }
            }
          },
          "400": {
            "description": ""
          },
          "404": {
            "description": ""
          },
          "500": {
            "description": ""
          }
        }
      }
    },
    "/accounts/{address}/kv": {
      "get": {
        "tags": [
          "Accounts"
        ],
        "summary": "Get KV value under a given key path",
        "description": "Get KV value under a given key path for an account. If `key` is not provided,\nthe empty key path will be used.",
        "operationId": "get_kv_value",
        "parameters": [
          {
            "name": "address",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/KvValue"
                }
              }
            }
          },
          "404": {
            "description": ""
          },
          "500": {
            "description": ""
          }
        }
      }
    },
    "/accounts/{address}/kv/subkeys": {
      "get": {
        "tags": [
          "Accounts"
        ],
        "summary": "Get array of KV subkeys under a given key path",
        "description": "Get array of KV subkeys under a given key path for an account. If `key` is not provided,\nthe empty key path will be used.",
        "operationId": "get_kv_subkeys",
        "parameters": [
          {
            "name": "address",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              }
            }
          },
          "404": {
            "description": ""
          },
          "500": {
            "description": ""
          }
        }
      }
    },
    "/accounts/{address}/nonce": {
      "get": {
        "tags": [
          "Accounts"
        ],
        "summary": "Get nonce of an account",
        "operationId": "get_nonce",
        "parameters": [
          {
            "name": "address",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Nonce"
                }
              }
            }
          },
          "404": {
            "description": ""
          },
          "500": {
            "description": ""
          }
        }
      }
    },
    "/logs/{address}/persistent/requests": {
      "get": {
        "tags": [
          "Logs"
        ],
        "summary": "Fetch console logs by address",
        "description": "Fetch console logs by address from the log store only if persistent\nlogging is enabled on this Jstz node instance",
        "operationId": "persistent_logs",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 0
            }
          },
          {
            "name": "offset",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 0
            }
          },
          {
            "name": "address",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/LogRecord"
                  }
                }
              }
            }
          },
          "400": {
            "description": ""
          },
          "404": {
            "description": ""
          }
        }
      }
    },
    "/logs/{address}/persistent/requests/{request_id}": {
      "get": {
        "tags": [
          "Logs"
        ],
        "summary": "Fetch console logs by address and request id",
        "description": "Fetch console logs by address and request id from the log store only if persistent\nlogging is enabled on this Jstz node instance",
        "operationId": "persistent_logs_by_request_id",
        "parameters": [
          {
            "name": "address",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "request_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/LogRecord"
                  }
                }
              }
            }
          },
          "400": {
            "description": ""
          },
          "404": {
            "description": ""
          }
        }
      }
    },
    "/logs/{address}/stream": {
      "get": {
        "tags": [
          "Logs"
        ],
        "summary": "Stream console logs",
        "description": "Returns a stream of console logs from the given Smart Function as Server-Sent Events.",
        "operationId": "stream_log",
        "parameters": [
          {
            "name": "address",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successfully connected to log stream as Server-Sent Events"
          },
          "400": {
            "description": ""
          },
          "404": {
            "description": ""
          }
        }
      }
    },
    "/operations": {
      "post": {
        "tags": [
          "Operations"
        ],
        "summary": "Inject an operation into Jstz",
        "operationId": "inject",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SignedOperation"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Operation successfully injectedd"
          },
          "400": {
            "description": ""
          },
          "500": {
            "description": ""
          }
        }
      }
    },
    "/operations/{operation_hash}/receipt": {
      "get": {
        "tags": [
          "Operations"
        ],
        "summary": "Get the receipt of an operation",
        "operationId": "receipt",
        "parameters": [
          {
            "name": "operation_hash",
            "in": "path",
            "description": "Operation hash",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Receipt"
                }
              }
            }
          },
          "400": {
            "description": ""
          },
          "500": {
            "description": ""
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Content": {
        "oneOf": [
          {
            "allOf": [
              {
                "$ref": "#/components/schemas/DeployFunction"
              },
              {
                "type": "object",
                "required": [
                  "_type"
                ],
                "properties": {
                  "_type": {
                    "type": "string",
                    "enum": [
                      "DeployFunction"
                    ]
                  }
                }
              }
            ],
            "title": "DeployFunction"
          },
          {
            "allOf": [
              {
                "$ref": "#/components/schemas/RunFunction"
              },
              {
                "type": "object",
                "required": [
                  "_type"
                ],
                "properties": {
                  "_type": {
                    "type": "string",
                    "enum": [
                      "RunFunction"
                    ]
                  }
                }
              }
            ],
            "title": "RunFunction"
          }
        ],
        "discriminator": {
          "propertyName": "_type"
        }
      },
      "DeployFunction": {
        "type": "object",
        "required": [
          "function_code",
          "account_credit"
        ],
        "properties": {
          "account_credit": {
            "$ref": "#/components/schemas/u64",
            "description": "Amount of tez to credit to the smart function account, debited from the sender"
          },
          "function_code": {
            "$ref": "#/components/schemas/ParsedCode",
            "description": "Smart function code"
          }
        }
      },
      "DeployFunctionReceipt": {
        "type": "object",
        "required": [
          "address"
        ],
        "properties": {
          "address": {
            "$ref": "#/components/schemas/PublicKeyHash"
          }
        }
      },
      "DepositReceipt": {
        "type": "object",
        "required": [
          "account",
          "updated_balance"
        ],
        "properties": {
          "account": {
            "$ref": "#/components/schemas/PublicKeyHash"
          },
          "updated_balance": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          }
        }
      },
      "FaDepositReceipt": {
        "type": "object",
        "required": [
          "receiver",
          "ticket_balance"
        ],
        "properties": {
          "receiver": {
            "$ref": "#/components/schemas/PublicKeyHash"
          },
          "run_function": {
            "oneOf": [
              {
                "type": "null"
              },
              {
                "$ref": "#/components/schemas/RunFunctionReceipt"
              }
            ]
          },
          "ticket_balance": {
            "$ref": "#/components/schemas/u64"
          }
        }
      },
      "FaWithdrawReceipt": {
        "type": "object",
        "required": [
          "source",
          "outbox_message_id"
        ],
        "properties": {
          "outbox_message_id": {
            "$ref": "#/components/schemas/String"
          },
          "source": {
            "$ref": "#/components/schemas/PublicKeyHash"
          }
        }
      },
      "KvValue": {
        "type": "string",
        "format": "json",
        "description": "A value stored in the Key-Value store. Always valid JSON."
      },
      "LogLevel": {
        "type": "string",
        "enum": [
          "ERROR",
          "WARN",
          "INFO",
          "LOG"
        ]
      },
      "LogRecord": {
        "type": "object",
        "required": [
          "address",
          "request_id",
          "level",
          "text"
        ],
        "properties": {
          "address": {
            "$ref": "#/components/schemas/PublicKeyHash"
          },
          "level": {
            "$ref": "#/components/schemas/LogLevel"
          },
          "request_id": {
            "type": "string"
          },
          "text": {
            "type": "string"
          }
        }
      },
      "Nonce": {
        "type": "integer",
        "format": "int64",
        "minimum": 0
      },
      "Operation": {
        "type": "object",
        "required": [
          "source",
          "nonce",
          "content"
        ],
        "properties": {
          "content": {
            "$ref": "#/components/schemas/Content"
          },
          "nonce": {
            "$ref": "#/components/schemas/Nonce"
          },
          "source": {
            "$ref": "#/components/schemas/PublicKeyHash"
          }
        }
      },
      "ParsedCode": {
        "type": "string",
        "format": "javascript",
        "example": "export default (request) => new Response('Hello world!')"
      },
      "PublicKey": {
        "oneOf": [
          {
            "type": "string",
            "title": "Ed25519",
            "example": "edpkukK9ecWxib28zi52nvbXTdsYt8rYcvmt5bdH8KjipWXm8sH3Qi"
          },
          {
            "type": "string",
            "title": "Secp256k1",
            "example": "sppk7aMwoVDiMGXkzwqPMrqHNE6QrZ1vAJ2CvTEeGZRLSSTM8jogmKY"
          },
          {
            "type": "string",
            "title": "P256",
            "example": "p2pk67ArUx3aDGyFgRco8N3pTnnnbodpP2FMZLAewV6ZAVvCxKjW3Q1"
          }
        ],
        "description": "Tezos public key"
      },
      "PublicKeyHash": {
        "oneOf": [
          {
            "type": "string",
            "title": "Tz1",
            "example": "tz1cD5CuvAALcxgypqBXcBQEA8dkLJivoFjU"
          },
          {
            "type": "string",
            "title": "Tz2",
            "example": "tz2KDvEL9fuvytRfe1cVVDo1QfDfaBktGNkh"
          },
          {
            "type": "string",
            "title": "Tz3",
            "example": "tz3QxNCB8HgxJyp5V9ZmCVGcTm6BzYc14k9C"
          }
        ],
        "description": "Tezos Address"
      },
      "Receipt": {
        "type": "object",
        "required": [
          "hash",
          "result"
        ],
        "properties": {
          "hash": {
            "type": "string"
          },
          "result": {
            "$ref": "#/components/schemas/ReceiptResult"
          }
        }
      },
      "ReceiptContent": {
        "oneOf": [
          {
            "allOf": [
              {
                "$ref": "#/components/schemas/DeployFunctionReceipt"
              },
              {
                "type": "object",
                "required": [
                  "_type"
                ],
                "properties": {
                  "_type": {
                    "type": "string",
                    "enum": [
                      "DeployFunction"
                    ]
                  }
                }
              }
            ],
            "title": "DeployFunction"
          },
          {
            "allOf": [
              {
                "$ref": "#/components/schemas/RunFunctionReceipt"
              },
              {
                "type": "object",
                "required": [
                  "_type"
                ],
                "properties": {
                  "_type": {
                    "type": "string",
                    "enum": [
                      "RunFunction"
                    ]
                  }
                }
              }
            ],
            "title": "RunFunction"
          },
          {
            "allOf": [
              {
                "$ref": "#/components/schemas/DepositReceipt"
              },
              {
                "type": "object",
                "required": [
                  "_type"
                ],
                "properties": {
                  "_type": {
                    "type": "string",
                    "enum": [
                      "Deposit"
                    ]
                  }
                }
              }
            ],
            "title": "Deposit"
          },
          {
            "allOf": [
              {
                "$ref": "#/components/schemas/FaDepositReceipt"
              },
              {
                "type": "object",
                "required": [
                  "_type"
                ],
                "properties": {
                  "_type": {
                    "type": "string",
                    "enum": [
                      "FaDeposit"
                    ]
                  }
                }
              }
            ],
            "title": "FaDeposit"
          },
          {
            "allOf": [
              {
                "$ref": "#/components/schemas/FaWithdrawReceipt"
              },
              {
                "type": "object",
                "required": [
                  "_type"
                ],
                "properties": {
                  "_type": {
                    "type": "string",
                    "enum": [
                      "FaWithdraw"
                    ]
                  }
                }
              }
            ],
            "title": "FaWithdraw"
          }
        ],
        "discriminator": {
          "propertyName": "_type"
        }
      },
      "ReceiptResult": {
        "oneOf": [
          {
            "type": "object",
            "title": "Success",
            "required": [
              "inner",
              "_type"
            ],
            "properties": {
              "_type": {
                "type": "string",
                "enum": [
                  "Success"
                ]
              },
              "inner": {
                "$ref": "#/components/schemas/ReceiptContent"
              }
            }
          },
          {
            "type": "object",
            "title": "Failure",
            "required": [
              "inner",
              "_type"
            ],
            "properties": {
              "_type": {
                "type": "string",
                "enum": [
                  "Failed"
                ]
              },
              "inner": {
                "type": "string"
              }
            }
          }
        ]
      },
      "RunFunction": {
        "type": "object",
        "description": "Request used to run a smart function. The target smart function is given by the host part of the uri. The rest of the attributes will be handled by the smart function itself.",
        "required": [
          "uri",
          "method",
          "headers",
          "body",
          "gas_limit"
        ],
        "properties": {
          "body": {
            "type": [
              "array",
              "null"
            ],
            "items": {
              "type": "integer",
              "format": "int32",
              "minimum": 0
            }
          },
          "gas_limit": {
            "type": "integer",
            "description": "Maximum amount of gas that is allowed for the execution of this operation",
            "minimum": 0
          },
          "headers": {
            "type": "object",
            "description": "Any valid HTTP headers"
          },
          "method": {
            "type": "string",
            "description": "Any valid HTTP method",
            "examples": [
              "GET",
              "POST",
              "PUT",
              "UPDATE",
              "DELETE"
            ]
          },
          "uri": {
            "type": "string",
            "format": "uri",
            "description": "Smart function URI in the form tezos://{smart_function_address}/rest/of/path",
            "examples": [
              "tezos://tz1cD5CuvAALcxgypqBXcBQEA8dkLJivoFjU/nfts?status=sold"
            ]
          }
        }
      },
      "RunFunctionReceipt": {
        "type": "object",
        "required": [
          "body",
          "status_code",
          "headers"
        ],
        "properties": {
          "body": {
            "type": [
              "array",
              "null"
            ],
            "items": {
              "type": "integer",
              "format": "int32",
              "minimum": 0
            }
          },
          "headers": {
            "type": "object",
            "description": "Any valid HTTP headers"
          },
          "status_code": {
            "type": "integer",
            "description": "Valid status code",
            "minimum": 0
          }
        }
      },
      "Signature": {
        "oneOf": [
          {
            "type": "string",
            "title": "Ed25519 signature",
            "example": "edsigtpe2oRBMFdrrwf99ETNjmBaRzNDexDjhancfQdz5phrwyPPhRi9L7kzJD4cAW1fFcsyTJcTDPP8W4H168QPQdGPKe7jrZB"
          },
          {
            "type": "string",
            "title": "Secp256k1 signature",
            "example": "spsig1NajZUT4nSiWU7UiV98fmmsjApFFYwPHtiDiJfGMgGL6oP3U9SPEccTfhAPdnAcvJ6AUSQ8EBPxYNX4UeNNDLBxVg9qv5H"
          },
          {
            "type": "string",
            "title": "P256 signature",
            "example": "p2signEdtYeHXyWfCaGej9AFv7QraDsunRimyK47YGBQRNDEPXPQctwjPxbyFbTUtVLsACzG8QTrLAxddjjTRikF3nThwKL8nH"
          }
        ]
      },
      "SignedOperation": {
        "type": "object",
        "required": [
          "public_key",
          "signature",
          "inner"
        ],
        "properties": {
          "inner": {
            "$ref": "#/components/schemas/Operation"
          },
          "public_key": {
            "$ref": "#/components/schemas/PublicKey"
          },
          "signature": {
            "$ref": "#/components/schemas/Signature"
          }
        }
      },
      "String": {
        "type": "string"
      },
      "u64": {
        "type": "integer",
        "format": "int64",
        "minimum": 0
      }
    }
  }
}